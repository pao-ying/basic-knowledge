# 前置链接

https://zhuanlan.zhihu.com/p/179266232

# 数据分片sharding

在分布式存储中，需要将数据分发在多个数据库中。所以使用数据分片的方法，如系统有三个数据库，接受到一条订单数据，对订单号进行hash，并对3取余，若结果为3，则存储在编号为3的数据库中。

当时这种分片方法**伸缩性比较差**。当有节点**增加或者宕机**时，就会**降低命中率**，需要重新进行hash.

# 一致性hash

一致性hash就是为了解决数据分片在增加或者减少节点时，伸缩性差的问题，提高命中率。

## hash环

将2^31个hash值放在环中，并且取得各个服务器的hash值，对应在hash环中。之后若有数据需要处理时，可以先将其中的某个值进行hash，并且对应到hash环中，顺序查找第一个遇到的环中的服务器，交由该服务器进行处理。

## 容错性

当某一台服务器宕机，则受影响的数据仅仅是该服务器到前一台服务器中间的数据。

## 可扩展性

当添加服务器时，受影响的数据也是该服务器当前一台服务器之间的数据。

## 数据倾斜

当hash环中的**节点分布不均**时，即大量的数据缓存在某几台服务器上时，就会发生**数据倾斜**的问题。

这个时候采用**虚拟节点**的机制，即**一个服务器计算多个hash值**，且每个结算结果都放入hash环，作为虚拟节点，以此达到分布均匀的效果。

# 实际使用

redis集群没有使用**一致性hash**，而是使用的**hash槽slots的概念**。