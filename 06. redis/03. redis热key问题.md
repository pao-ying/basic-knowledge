# 热key问题

就是突然有几十万请求访问redis的某一个key。

- 导致这条redis服务器宕机
- 接下来请求直接落在数据库上，导致**服务不可用**

# 发现热key

- 凭借业务经验

  如商品在做秒杀时，该商品的key就是热key

- 在客户端进行收集

  在客户端添加代码进行**数据统计**。

  容易造成**代码入侵**。

- **在proxy层**收集

  即**在客户端和redis集群**之间加一个proxy层，proxy层是redis服务器的统一入口，**在proxy层上做数据上报**。

  缺点是并不是所有**redis集群架构**都有proxy层

- 用redis自带的命令

  - **monitor**命令，实时抓取redis服务器接受的命令
  - **hotkeys**参数，即热key发现功能

- 自己抓包分析

# 解决方法

## 利用二级缓存

当发现热key后，**将热key加载到系统JVM上**。当几十万针对同一个key的请求落下来后，会分发到多个服务器上，从JVM中取到value值。避免了几十万请求同时落到redis的情况。

## 备份热key

意思就是**让key不存在于单独一个redis服务器上**，将这个key和value放在多个redis服务器上，当热key请求进来时，就从**有备份**的redis服务器上选取一台返回value。

