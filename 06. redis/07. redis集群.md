# 主从模式

即 `Master-Slave Republication`

## 工作原理

1. slave启动后，向master发送SYNC命令，master接收到SYNC命令后通过bgsave保存快照（即上文所介绍的RDB持久化），并使用缓冲区记录保存快照这段时间内执行的写命令

2. master将保存的快照文件发送给slave，并继续记录执行的写命令

3. slave接收到快照文件后，加载快照文件，载入数据

4. master快照发送完后开始向slave发送缓冲区的写命令，slave接收命令并执行，完成复制初始化

5. 此后master每次执行一个写命令都会同步发送给slave，保持master与slave之间数据的一致性

![img](..\img\format,png)

# Sentinel哨兵机制

![img](..\img\format2,png)

哨兵机制是基于主从复制机制的，引入了**哨兵来监控与自动处理故障**。

## 功能

1. 监控 master, slave 是否正常工作
2. 当 master 故障时，能自动将一个 slave 转换为 master
3. 多个哨兵可以监控同一个 redis， 哨兵之间也会自动监控。

## 机制

客户端连接 redis 时，先连接哨兵，哨兵会告诉客户端 redis 主节点地址，然后客户端连接上 redis 并进行后续操作。当主节点宕机时，哨兵检测到主节点宕机，会重新推选一个表现良好的从节点作为主节点，通过**发布订阅模式**通知其它从服务器，让他们切换主机。

# cluster机制

cluster 即**集群**

集群主要用于分担写入压力，主从节点用于**灾难备份和高可用以及分档读压力**

## 对比

主从复制不能**主动故障转移，达不到高可用**的问题

哨兵模式解决了主从复制不能主动故障转移，达不到高可用问题，但是存在**主节点的写能力、容量受限于单机配置**问题。

cluster 模式实现了 redis 的**分布式存储**，每个节点存储不同的内容，解决了主节点的写能力、容量受限于单机配置的问题。

https://www.cnblogs.com/lovezbs/p/14055594.html