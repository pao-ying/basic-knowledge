# 总体过程

1. DNS解析

   域名解析成对应的服务器IP地址这项工作，是由DNS服务器来完成的。客户端收到你输入的域名地址后，它首先去找本地的hosts文件，检查在该文件中是否有相应的域名、IP对应关系，如果有，则向其IP地址发送请求，如果没有，再去找DNS服务器。

   浏览器客户端向本地DNS服务器发送一个含有域名www.cnblogs.com的DNS查询报文。本地DNS服务器把查询报文转发到根DNS服务器，根DNS服务器注意到其com后缀，于是向本地DNS服务器返回comDNS服务器的IP地址。本地DNS服务器再次向comDNS服务器发送查询请求，comDNS服务器注意到其www.cnblogs.com后缀并用负责该域名的权威DNS服务器的IP地址作为回应。最后，本地DNS服务器将含有www.cnblogs.com的IP地址的响应报文发送给客户端。

   **从客户端到本地服务器属于递归查询，而DNS服务器之间的交互属于迭代查询。**

2. TCP连接

   通过三次握手建立 TCP 连接

3. 发送HTTP请求

   ![图片描述](..\img\bVYTYc)

   封装 HTTP 报文。

4. 服务器处理请求并返回HTTP报文

   服务器端收到请求后的由web服务器（准确说应该是http服务器）处理请求，诸如Apache、Ngnix、IIS等。web服务器解析用户请求，知道了需要调度哪些资源文件，再通过相应的这些资源文件处理用户请求和参数，并调用数据库信息，最后将结果通过web服务器返回给浏览器客户端。

   ![图片描述](..\img\bVYTYF)

   ![图片描述](..\img\bVYQcs)

5. 关闭 TCP 连接

   为了避免服务器与客户端双方的资源占用和损耗，当双方没有请求或响应传递时，任意一方都可以发起关闭请求。与创建TCP连接的3次握手类似，关闭TCP连接，需要4次握手。

6. 浏览器解析 HTML

   准确地说，浏览器需要加载解析的不仅仅是HTML，还包括CSS、JS。以及还要加载图片、视频等其他媒体资源。	

7. 浏览器布局渲染

   根据渲染树布局，计算CSS样式，即每个节点在页面中的大小和位置等几何信息。HTML默认是流式布局的，CSS和js会打破这种布局，改变DOM的外观样式以及大小和位置。这时就要提到两个重要概念：replaint和reflow。

# DNS

DNS 协议就是用来将域名转换为 IP 地址, 也可以将 IP 地址转换为相应的域名.

DNS 服务器是基于 UDP 实现的, 服务器端口号为 **53**

## DNS 域名

![这里写图片描述](..\img\70fd)

## DNS 解析

1. 主机向本地域名服务器进行**递归查询**
2. 本地域名服务器采用**迭代查询**, 向根域名服务器进行查询
3. 根域名服务器返回顶级域名服务器 IP
4. 本地域名服务器向顶级域名服务器 IP 进行查询
5. 顶级域名服务器返回二级域名服务器 IP,
6. 以此类推, 知道得到想要的地址 IP 并返回给主机

### 递归查询

本机向本地域名服务器发出查询请求, 就等待查询结果. 如果本地域名服务器无法解析就会自己向其它 DNS 服务器发送查询, 知道得到结果告诉主机 IP 地址.

### 迭代查询

本地域名服务器向根域名服务器查询, 根域名服务器告诉本地域名服务器下一步往哪儿查询, 然后去查, 依次查询, 知道得到结果.

### 为什么使用 UDP

衡量计算机通信快慢的指标就是**响应时间**。

响应时间可以分为三部分：

> 响应时间=DNS域名解析时间+TCP连接建立时间+HTTP交易时间

TCP是固定的三次握手，HTTP是基于 Request/Response，这两者都很难缩短时间，所以只能让 DNS 域名解析时间越小越好。

又因为 DNS 采用迭代查询，需要频繁的与多个 DNS 服务器建立连接，所以采用 UDP，尽可能将数据报传输到对端，至于对端能不能接受到并不关心，可以提高相应速度。
