# 四大核心组件

Android 系统没有使用常见的应用程序入口点的方法（例如C语言中的 main() 方法），应用程序是由组件组成的，组件可以调用相互独立的基本功能模块。根据完成的功能不同，Android 划分了 4 类核心组件，即 Activity、Service、BroadcastReceiver 和 ContentProvider，**各组件之间的消息传递通过 Intent 完成。**

## Activity

Activity 是 Android 应用程序核心组件中最基本的一种，**是用户和应用程序交互的窗口**。

一个 Activity 通常对应一个单独的视图，一个 Android 应用程序是由一个或多个 Activity 组成的，这些 Activity 相当于 Web 应用程序中的网页，用于显示信息，并且相互之间可以进行跳转，和网页跳转不同的是，Activity 之间的跳转可以有返回值。

### 生命周期

从本质上讲，Activity 生命周期总共存在三种状态：

1. 运行态

   指 Activity 运行于屏幕的最上层并且获得了用户焦点。

2. 暂停态

   指当前 Activity 依然存在，但是没有获得用户焦点。

   在其之上有其他的 Activity 处于运行态，但是由于处于运行态的 Activity 没有遮挡住整个屏幕，当前 Activity 有一部分视图可以被用户看见。处于暂停态的 Activity 保留了自己所使用的内存和用户信息，但是在系统极度缺乏资源的情况下，有可能会被杀死以释放资源。

3. 停止态

   指当前 Activity 完全被处于运行态的 Activity 遮挡住，其用户界面完全不能被用户看见。

   处于停止态的 Activity 依然存活，也保留了自己所使用的内存和用户信息，但是一旦系统缺乏资源，停止态的 Activity 就会被杀死以释放资源。

Activity 状态转换的回调方法

| 名称                                | 调用时间                                                     |
| ----------------------------------- | ------------------------------------------------------------ |
| onCreate(Bundle savedInstanceState) | 创建 Activity 时调用。  设置在该方法中，还以 Bundle 的形式提供对以前储存的任何状态的访问。其中参数 savedInstanceState 对象是用于保存 Activity 的对象的状态。 |
| onStart()                           | Activity 变为在屏幕上对用户可见时调用。                      |
| onResume()                          | Activity 开始与用户交互时调用（无论是启动还是重启一个活动，该方法总是被调用）。 |
| onPause()                           | 当 Android 系统要激活其他 Activity 时，该方法被调用，暂停或收回 CPU 和其他资源时调用。 |
| onStop()                            | Activity 被停止并转为不可见阶段时调用。                      |
| onRestart()                         | 重新启动已经停止的 Activity 时调用。                         |
| onDestroy()                         | Activity 被完全从系统内存中移除时调用。  该方法被调用可能是因为有人直接调用 finish() 方法或者系统决定停止该活动以释放资源。 |

- 启动 Activity：在这个阶段依次执行 3 个生命周期方法：onCreate、onStart 和 onResume。
- Activity 失去焦点：如果在 Activity 获得焦点的情况下进入其他的 Activity 或应用程序，这时当前的 Activity 会失去焦点。在这一阶段，会依次执行 onPause 和 onStop 方法。
- Activity 重获焦点：如果 Activity 重新获得焦点，会依次执行 3 个生命周期方法：onRestart、onStart 和 onResume。
- 关闭 Activity：当 Activity 被关闭时，系统会依次执行 3 个生命周期方法：onPause、onStop 和 onDestroy。

## Service

Service 是一种类似于 Activity 但是没有视图的程序，它没有用户界面，可以在后台运行很长时间，相当于**操作系统中的一个服务**。

Android 定义了两种类型的 Service，即本地 Service 和远程 Service。本地 Service 是只能由**承载该 Service 的应用程序**访问的组件，而远程 Service 是供在设备上运行的**其他应用程序远程访问**的 Service。

通过 Context.startService(Intent service) 可以启动一个 Service，通过 Context. bindService() 可以绑定一个 Service。

### 生命周期

- startService 方式启动 Service

  StartService -> onCreate() -> onStartCommand() -> StopService() -> onDestory() -> 结束

- bindService() 绑定一个 Service

  BindService -> onCreate() -> onBind() -> unBindService() -> onUnbind() -> onDestroy() -> 结束

两者的区别

- startService 和 stopService 只能开启和关闭，无法操作 service

  bindService 和 unBindService 可以操作 Service

- start开启的service，调用者退出后service仍然存在。bind开启的service，调用者退出后，随着调用者销毁。

| 方法             | 含义 |
| ---------------- | ---- |
| onCreate()       | 创建 |
| onStartCommand() | 开始 |
| onDestroy()      | 销毁 |
| onBind()         | 绑定 |
| onUnbind()       | 解绑 |

注意：

1.在整个生命周期内，只有**startCommand()**能被多次调用。其他方法只能被调用**一次**。（即只能绑定和解绑一次。）
 2.绑定后没有解绑，**无法**使用stopService()将其停止。
 3.如果已经onCreate()，那么startService()将**只**调用startCommand()。
 4.如果是以bindService开启，那么使用unbindService时就会**自动调用**onDestroy销毁。

## BroadcastReceiver

BroadcastReceiver 的意思是“广播接收者”，顾名思义，它用来接收来自系统和其他应用程序的广播，并做出回应。

> 在 Android 系统中，当有特定事件发生时就会产生相应的广播。
>
> - 当开机过程完成后，系统会产生一条广播，接收到这条广播就能实现开机启动服务的功能；
> - 当网络状态改变时，系统会产生一条广播，接收到这条广播就能及时地做出提示和保存数据等操作；
> - 当电池电量改变时，系统会产生一条广播，接收到这条广播就能在电量低时告知用户及时保存进度等。

BroadcastReceiver 不能生成 UI，通过 NotificationManager 来通知用户有事件发生，对于用户来说是隐式的。

BroadcastReceiver 的 2 种注册方式：

- 在 **AndroidManifest. xml** 中进行**静态注册**；
- 在运行时的代码中使用 Context.registerReceiver() 进行**动态注册**。

只要注册了 BroadcastReceiver，即使对应的事件广播来临时应用程序并未启动，**系统也会自动启动该应用程序对事件进行处理**。另外，用户还可以通过 Context.sendBroadcast() 将自己的 Intent 对象广播给其他的应用程序。

## ContentProvider

文件、数据库等数据在 Android 系统内是私有的，仅允许被特定应用程序直接使用。

在两个程序之间，数据的交换或共享由 ContentProvider 实现。

ContentProvider 类实现了一组标准方法的接口，从而能够让其他的应用保存或读取 ContentProvider 提供的各种数据类型。

## Intent

Android 应用程序核心组件中的三大核心组件 —— Activity、Service、BroadcastReceiver。通过消息机制被启动激活，而所使用的消息就是 Intent。Intent 是对即将要进行的操作的抽象描述，**承担了 Android 应用程序三大核心组件相互之间的通信功能**。

