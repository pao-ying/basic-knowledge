# 调优参数

- -Xms2g：初始化推大小为 2g； 

- -Xmx2g：堆最大内存为 2g； 

- -XX:NewRatio=4：设置年轻的和老年代的内存比例为 1:4； 

- -XX:Sur[vivo]()rRatio=8：设置新生代 Eden 和 Sur[vivo]()r 比例为 8:2； 

- –XX:+UseParNewGC：指定使用 ParNew + Serial Old 垃圾回收器组合； 

- -XX:+UseParallelOldGC：指定使用 ParNew + ParNew Old 垃圾回收器组合； 

- -XX:+UseConcMarkSweepGC：指定使用 CMS + Serial Old 垃圾回收器组合； 

- -XX:+PrintGC：开启打印 gc 信息； 

- -XX:+PrintGCDetails：打印 gc 详细信息。

# JVM调优工具

## jps

列本机所有Java进程的Pid

- -l 输出完全的包名
- -v 输出jvm参数

- -m 输出 main method 参数

```
jps -lvm
//output
//4124 com.zzx.Application -javaagent:E:\IDEA2019\lib\idea_rt.jar=10291:E:\IDEA2019\bin -Dfile.encoding=UTF-8
```

## jstack

查看某个Java进程内的线程堆栈信息

- -l 打印额外的锁信息

```
jstack -l 4124
```

## jstat

虚拟机各种运行状态信息

- gcutil 查看新生代, 老年代和永久代GC情况

```
jstat -gcutil 4124
  S0     S1     E      O      M     CCS    YGC     YGCT    FGC    FGCT     GCT
  0.00   0.00  67.21  19.20  96.36  94.96     10    0.084     3    0.191    0.275
```

## jmap

查看堆内存快照. 查看进程中新生代, 老年代, 永久代使用情况

```
>jmap -heap 4124
Attaching to process ID 4124, please wait...
Debugger attached successfully.
Server compiler detected.
JVM version is 25.221-b11

using thread-local object allocation.
Parallel GC with 6 thread(s)

Heap Configuration:
   MinHeapFreeRatio         = 0
   MaxHeapFreeRatio         = 100
   MaxHeapSize              = 4238344192 (4042.0MB)
   NewSize                  = 88604672 (84.5MB)
   MaxNewSize               = 1412431872 (1347.0MB)
   OldSize                  = 177733632 (169.5MB)
   NewRatio                 = 2
   SurvivorRatio            = 8
   MetaspaceSize            = 21807104 (20.796875MB)
   CompressedClassSpaceSize = 1073741824 (1024.0MB)
   MaxMetaspaceSize         = 17592186044415 MB
   G1HeapRegionSize         = 0 (0.0MB)

Heap Usage:
PS Young Generation
Eden Space:
   capacity = 327155712 (312.0MB)
   used     = 223702392 (213.33922576904297MB)
   free     = 103453320 (98.66077423095703MB)
   68.37795697725736% used
From Space:
   capacity = 21495808 (20.5MB)
   used     = 0 (0.0MB)
   free     = 21495808 (20.5MB)
   0.0% used
To Space:
   capacity = 23068672 (22.0MB)
   used     = 0 (0.0MB)
   free     = 23068672 (22.0MB)
   0.0% used
PS Old Generation
   capacity = 217579520 (207.5MB)
   used     = 41781472 (39.845916748046875MB)
   free     = 175798048 (167.65408325195312MB)
   19.20285144484187% used

27776 interned Strings occupying 3262336 bytes.
```

