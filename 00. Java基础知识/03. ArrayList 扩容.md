以 JDK11 代码为例：

# 初始化

- 无参构造

  ```java
  this.elementData = DEFAULTCAPACITY_EMPTY_ELEMENTDATA;
  ```

  ```java
  DEFAULTCAPACITY_EMPTY_ELEMENTDATA = {};
  ```

- 初始化容量为0，则设置

  ```java
  this.elementData = CAPACITY_EMPTY_ELEMENTDATA;
  ```

  其中

  ```java
  DEFAULTCAPACITY_EMPTY_ELEMENTDATA = {};
  ```

- 若初始化容量不为0，则设置

  ```java
  this.elementData = new Object[initialCapacity];
  ```

# add

判断 `elementData.length` 和 `size` 是否相等，相等的情况下调用 `grow()` 进行扩容

# grow

1. grow() 调用 newCapacity() 计算最小扩容的大小，传入 `size + 1`;
2. 再返回 Arrays.CopyOf(elementData, capacity)

# newCapacity

1. 首先将旧容量 `elementData.length` 扩容 **1.5** 倍得到新容量 `newCapacity`。

2. 如果新容量 `newCapacity` <= 最小扩容的大小 `minCapacity`.

   1. 如果是无参构造的

      返回 **默认大小10** 与 最小扩容大小 `minCapacity` 的最大值。

   2. 如果最小扩容大小 < 0

      抛出 OOM 异常

3. 如果新容量 newCapacity > 最小扩容的大小 minCapacity

   1. 如果新容量 newCapacity <= `MAX_ARRAY_SIZE` 即最大数组容量 `Integer.MAX_VALUE` - 8

      返回新容量 newCapacity

   2. 调用 `hugeCapacity()`

# hugeCapacity()

1. 若最小扩容的大小 `minCapacity` < 0

   则抛出 OOM

2. 若最小扩容的大小 `minCapacity`  > 0

   1. 若 `minCapacity` > `MAX_ARRAY_SIZE`

      返回 Integer.MAX_VALUE

   2. 否则

      返回 MAX_ARRAY_SIZE