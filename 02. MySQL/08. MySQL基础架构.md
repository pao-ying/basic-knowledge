# MySQL架构

- server 层

  - **连接器**：身份认证和权限相关（登录MySQL时使用）

  - **查询缓存**：在MySQL8.0后移除

  - **分析器**

    MySQL 没有命中缓存，就会进入分析器，分析 SQL 是用来干嘛的。

    - 第一步，**词法分析**

      即提取关键字，如 select、表名、字段名、查询条件等

    - 第二部，**语法分析**

      判断输入的 SQL 是否正确

  - 优化器

    使用它认为最优的执行方案。

  - 执行器

    MySQL 开始执行，先检查是否有权限，再**调用引擎的接口**，返回接口执行的结果。

- 存储引擎

  主要负责数据的存储和读取。

# 查询过程

```sql
select * from tb_student A where A.age='18' ans A.name='张三'
```

- 检查是否有权限。有权限就查询缓存（MySQL8.0之前），**以SQL语句为key，查询是否有结果**，有就直接返回，没有就进行下一步。
- 通过**分析器**进行**词法分析**，提取SQL关键字。然后进行**语法分析**，检查是否有错误。
- 之后通过**优化器**确定执行方案。
- 再进行权限校验，没有权限返回错误信息。有权限则调用数据库引擎，返回引擎结果。

# 更新过程

```sql
update tb_student A set A.age='19' where A.name='张三';
```

- 先执行**查询**操作，如果有缓存，先用到缓存。
- 调用**引擎API接口**，执行更新语句，InnoDB将数据先保存在内存中，同时**记录 redo log**，此时 redo log 进入 **prepare** 状态，然后告诉**执行器**，执行完成，随时可以提交。
- 执行器收到通知后**记录 bin log**，然后调用引擎接口提交，并**修改 redo log 为提交状态**。
- 更新完成。