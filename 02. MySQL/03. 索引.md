# 索引

索引是存储引擎用于提高数据库查询效率的数据结构

## 优缺点

### 优点

- 加快查询效率
- 可加快分组和排序的速度
- 加速表与表之间的连接

## 缺点

- 索引需要物理文件存储，耗费空间
- 会降低表的增删改的效率，每次对表记录进行增删改，都要对索引进行维护。

## 分类

- 主键索引

- 二级索引（辅助索引）

  - 唯一索引 unique

    **与主键索引的区别是允许为空，且可创建多个。**

  - 普通索引 index

  - 前缀索引 prefix

  - 全文索引 full

# 加快查询原理

数据是存储在磁盘上的，查询数据时，如果没有索引，则所有数据都会加载到内存上，依次进行检索，读取次数较多。如果使用索引，不需要加载所有数据，因为**B+树的高度一般在2-4层，最多只需要读取2-4次磁盘**，查询速度大大提高。

# 建立索引的情况

- 经常用于查询的**字段**
- 经常用于连接的字段（如外键）
- 经常需要**排序**的字段，因为索引已经排好序，可加快排序查询速度。

# B树与B+树

## 区别

- B树所有节点即可存放键也可存放数据，而B+树只有叶子节点存放key和data，其它节点只存放key
- B树的叶子节点都是独立的，B+树的叶子节点与它相邻的叶子节点间有一条引用链。
- B树就每个节点做二分查找，可能没有到叶子节点久结束了。而B+树的**检索效率更稳定**，任何查找都是从根节点到叶子节点的过程。

## 选择B+而不是B的原因

1. B+树的数据都保存在叶子节点，更方便进行区间访问。

   > 数据库索引采用B+树的主要原因是 B树在提高了磁盘IO性能的同时并没有解决元素遍历的效率低下的问题。正是为了解决这个问题，B+树应运而生。B+树只要遍历叶子节点就可以实现整棵树的遍历。而且在数据库中基于范围的查询是非常频繁的，而B树不支持这样的操作（或者说效率太低）

2. B+树的内节点只会存储索引key值，具体的信息存在于叶子节点中。那么相比于B树的内节点来说，没有Data值，那么节点的大小就会更小，那么就能够减少IO的次数。（磁盘IO一次读出的数据量大小是固定的，单个数据变大，每次读出的就少，IO次数增多）

3. B+树的查询效率更稳定，任何**关键字**的查找必须从根节点到叶子节点。

## 建立

https://www.jianshu.com/p/08fe11a5fbb9

# hash索引与B+树索引与红黑树

- hash索引不支持排序和范围查找
- hash索引存在哈希冲突，所以性能不稳定。
- 红黑树的高度要大于B+树，会增加IO读取次数

# 最左匹配原则

在mysql中建立**联合索引**时，会遵循最左匹配原则，即最左优先，在检索数据时从联合索引的最左边开始匹配。同时当遇到范围查询时（>, <, between, like）就会停止匹配，右边的字段就不会用到索引

> 如对(abc)建立索引，查询条件a/ab/abc会走索引，使用bc不会。
>
> 如查询条件为a=1 and b>2 and c=3，那么ab能用到索引，而c不能用到索引。
>
> 对于(abc)建立联合索引，则a是有序的，a确定的情况下b是有序的，ab确定下c是有序的

# 聚集索引

**聚集索引就是索引和数据一次存放**。**主键索引属于聚集索引**。

聚集索引叶子节点的存储逻辑上是连续的，使用**双向链表**连接，叶子节点按照主键的顺序排序，因此对于主键的排序查找和范围查找速度比较快。

聚集索引的叶子节点存储的是行记录

## 优点

查询速度快，定位到了索引，就能够直接获取数据。

## 缺点

- 依赖于有序的数据
- 更新代价大，叶子节点是存储的整行数据。

# 非聚集索引

非聚集索引就是索引和数据分开存放。**二级索引（辅助索引）属于非聚集索引**。

## 优点

更新代价比聚集索引小

## 缺点

- 需要有序数据
- 可能会回表

# 索引图示

## MyISAM

![img](..\img\watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9saW51eHN0eWxlLmJsb2cuY3Nkbi5uZXQ=,size_16,color_FFFFFF,t_70)

![img](..\img\fdfdsafa)

## InnoDB

![img](..\img\rrrr)

![img](..\img\bb)

# 索引覆盖

## 定义

索引覆盖就是查询的字段正好是索引的字段，那么根据索引，就不需要**回表**进行二次查询。

## 实现索引覆盖

`name` 建立普通索引，`id` 为主键索引。

```sql
select id from user_table where name = '张三';
```

因为 name 索引树的叶子节点上保存有 name 和 id 的值，所以可以直接通过 name 索引树查找到 id，而不需要回表。

```sql
select password from user_table where name = '张三';
```

因为 name 索引树上的叶子节点并没有 password 的值，所以需要通过拿到叶子节点的 id 值，通过回表查找到 password.

## 参考链接

https://www.jianshu.com/p/8991cbca3854

# 创建索引注意事项

1. 选择合适的字段创建索引，如非空字段、频繁查询、排序连接字段

2. 不建议频繁更新的字段建立索引

3. 尽可能联合索引而不是单列索引

4. 字符串类型字段上使用**前缀索引**而不是普通索引

   > 前缀索引是指对文本或者字符串的前几个字符建立索引，这样索引更短，查询速度更快。

# 创建索引

```
ALTER TABLE table_name ADD INDEX index_name (c)
```

