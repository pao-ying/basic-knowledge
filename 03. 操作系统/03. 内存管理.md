# 内存管理方式

## 连续分配管理方式

为一个用户进程分配一个连续的内存空间

- 块式存储

  将内存分为固定大小的几块，程序需要内存时就分配一块。会产生很多的碎片。

## 非连续分配管理方式

允许一个程序使用的	内存分布在离散的内存中

- 页式存储

  将主存大小分为相等的一页一页的形式，页较小，更好管理。

  页式管理通过**页表**对应逻辑地址和物理地址

- 段式存储

  页式存储中的页没有实际意义。段式存储将内存分为一段一段的，每一段要比一页小很多。重要的是段是有实际意义的，每一个段定义了**一组逻辑信息**。如主程序段、子程序段等。

  段式存储通过**段表**对应逻辑地址和物理地址

- 段页式存储

  将内存分为一段一段的，再将每个段分为若干页。

分页和分段共同点和区别

- 共同点
  1. 提供内存利用率，减少碎片
  2. 离散存储
- 区别
  1. 页的大小固定，段的大小取决于运行的程序
  2. 段有实际意义，每个段定义了一组逻辑信息

# 缺页中断

当 CPU 访问的页面不在物理内存时，便会产生一个缺页中断，请求操作系统将所缺页调入到物理内存。

## 流程

![缺页中断的处理流程](..\img\缺页异常流程.png)

## 页表

![img](..\img\页表项字段.png)

- ***状态位***：用于表示该页是否有效，也就是说是否在物理内存中，供程序访问时参考。
- ***访问字段***：用于记录该页在一段时间被访问的次数，供页面置换算法选择出页面时参考。
- ***修改位***：表示该页在调入内存后是否有被修改过，由于内存中的每一页都在磁盘上保留一份副本，因此，如果没有修改，在置换该页时就不需要将该页写回到磁盘上，以减少系统的开销；如果已经被修改，则将该页重写到磁盘上，以保证磁盘中所保留的始终是最新的副本。
- ***硬盘地址***：用于指出该页在硬盘上的地址，通常是物理块号，供调入该页时使用。

# 虚拟内存流程

![虚拟内存的流程](..\img\虚拟内存管理流程.png)

# 快表和多级页表

## 快表 TLB

快表用于存储**最近访问的页**，如果在快表里面查不到，再去页表里面查找。

为了解决虚拟地址到物理地址的转换速度，类似于缓存，其中的内容是也页表的一部分内容或者全部内容。

## 多级页表

多级页表就是**页目录表+页表**，可以根据页表查找到对应的页。

避免将全部的页表都放入内存中，占用过多空间，而不需要的页表也在内存中占用不必要的空间。下·

https://blog.csdn.net/williamgavin/article/details/83240402

# CPU寻址

CPU寻址就是为了将虚拟地址转换为物理地址，才能访问到真实的物理内存。

## 虚拟地址空间

因为不能直接把物理地址空间暴漏给应用程序，所以使用虚拟地址空间间接访问。

# 虚拟内存

虚拟内存可以让程序拥有超过系统物理内存大小的内存可用空间，同时虚拟内存可以为每一个进程提供一个私有的地址空间，让每一个进程产生一种拥有一片连续完整的内存空间的错觉。这样可以进行有效管理和减少出错。

同时可以防止多进程数据操作越界的问题。

就是在硬盘空间上重新定义了一个**连续的虚拟地址空间**

https://blog.csdn.net/shellquery/article/details/100893040

## 技术实现

- 请求分页式存储
- 请求分段式存储
- 请求段页式存储

## 页面置换算法

当发生**缺页中断**时，即当前内存中没有空闲的页面，操作系统就必须选择一个页面将其移除，用来淘汰哪一页的规则就叫做页面置换算法。

- OPT页面置换算法（最佳页面置换算法）

  从内存中移除不再需要的页面，如果没有这样的页面，则**移除最长时间不需要访问**的页面。

- FIFO（先进先出页面置换算法）：淘汰最先进入内存的页面，即选择驻留时间最长的淘汰

- LRU（最近最久未使用）

- LFU（最近最少使用）