# 进程与线程

## 定义

进程是系统进行资源**分配和调度**的基本单位。

线程是CPU**调度和分派**的基本单位。

## 关系

一个进程可以有多个线程，多个线程之间可以并发执行。

多个进程间是相互独立的，但是同一进程下的线程可能会相互影响。

## 比较

- 开销

  进程创建和销毁，系统都需要为之**分配和回收资源**，导致系统的开销要大于线程的开销。

- 调度

  进程作为资源分配的基本单位，线程作为CPU调度的基本单位

- 并发性

  进程间可以并发执行，进程间也可以并发执行

- 拥有资源

  进程是系统中拥有资源的基本单位，线程不拥有资源，但可以访问隶属的进程资源。

# 进程有几种状态

- 创建状态

- 就绪状态

  获得了除CPU以外的所有资源

- 运行状态

- 阻塞状态

  进程正在等待某一事件完成，如等待某一资源可用或者等待IO操作。即使CPU空闲，也不能使用。

- 结束状态

  进程从系统消失。如进程正常结束或中断退出。

# 进程间的通信方式

- 管道/匿名管道

  他是半双工的，即数据只能在一个方向上流动，具有固定的读端和写端。同时管道的实质是**内核缓冲区**，管道一段的进程将数据写入缓冲区，另一端的进程从缓冲区读取数据，且两个进程必须是父子进程或者兄弟进程。

- 命名管道

  命名管道和管道的区别就是有名字，这个名字对应一个**磁盘索引文件**，通过这个文件，任何进程都可以访问该管道，从而实现本机内任意两个进程通信。

- 信号

  用于通知进程某个事件已经发生。

- 消息队列

  消息队列是一系列保存在内核中消息的列表，进程可以向消息队列中添加消息，也可以读取消息。消息队列与管道的不同是，消息都有指定的**消息类型**，进程在接收时可以根据自己的需求接收特定的消息。

- 信号量

  信号量是一个**计数器**，主要用于进程间对**共享数据**的访问和进程同步。它的实现是基于操作系统的 PV 操作。

- 共享内存

  共享内存允许多个进程共享一块存储区域，这块存储区域可以被进程**映射**到自己的进程空间中。共享内存的好处就是效率高，进程可以直接读取内存，而不需要进行内核空间和用户空间的数据拷贝。

- 套接字

  主要用于客户端和服务器直接进行通信。

https://blog.csdn.net/zhaohong_bo/article/details/89552188

# 进程同步机制

多进程下访问资源。

- 互斥量

  采用互斥对象机制，只有拥有互斥对象的线程才能对公共资源进行访问，由于互斥对象只有一个，所以能够保证公共资源不会被多线程访问。

- 信号量

  允许同一时刻**多个**线程对共享资源进行访问，但需要控制同一时刻访问该资源的最大线程量

- 事件

  wait/notify。通过通知等待的方式来保持进程同步。

# 进程的调度算法

队列中分配资源的顺序

- 先到先服务调度算法FCFS

  从就绪队列中选择**最先进入队列的**进程**分配资源**，知道他执行完成，或者转变为阻塞状态时再**重新调度**。

- 短作业优先算法

  从就绪队列中选择**运行时间最短**的进程分配资源。

- 时间片轮转调度算法

  为每一个进程分配相同的时间段执行。

- 最短剩余时间优先

  最短剩余时间优先是短作业优先增加了抢占机制的版本。当一个进程加入到就绪队列之后，他可能比当前运行的进程拥有更短的剩余时间，则在该进程就绪之后就可以抢占当前正在运行的进程。

- 最高响应比优先

  根据算式 R = (w+s)/s，w为等待处理时间，s为预计服务时间。

- 优先级调度

  为每个进程分配优先级，高优先级先执行，相同优先级以先到先服务算法执行。

- 多级反馈队列调度算法

  多级反馈队列调度算法设置多个调度队列，每个队列优先级不同，优先级越高的队列执行时间片越小。当新进程进入内存后，首先放到一号队列，如果它能在一个时间片内完成，就撤销，如果不能就转入二号队列，依次。当一号队列空闲才会调度二号队列。同时当正在处理后面的队列时，前面的队列又有了新的进程，则新的进程就会抢占 CPU。

  