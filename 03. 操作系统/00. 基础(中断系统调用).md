# 中断

所谓的中断就是在计算机执行程序的过程中，由于出现了某些特殊事情，使得CPU暂停对程序的执行，转而去执行处理这一事件的程序。等这些特殊事情处理完之后再回去执行之前的程序。

## 中断类型

1. 由计算机**硬件异常**或故障引起的中断，称为内部异常中断；
2. 由程序中执行了引起**中断的指令**而造成的中断，称为**软中断**（这也是和我们将要说明的**系统调用**相关的中断）；
3. 由**外部设备**请求引起的中断，称为外部中断。

## 中断处理程序

当中断发生的时候，系统需要去对中断进行处理，对这些中断的处理是由操作系统**内核中的特定函数**进行的，这些处理中断的特定的函数就是我们所说的中断处理程序了。

## 中断优先级

中断的优先级说明的是当一个中断正在被处理的时候，处理器能接受的中断的级别。中断的优先级也表明了中断需要被处理的紧急程度。

每个中断都有一个对应的优先级，当处理器在处理某一中断的时候，只有比这个中断优先级高的中断可以被处理器接受并且被处理。优先级比这个当前正在被处理的中断优先级要低的中断将会被忽略。

典型的中断优先级如下所示：

```
机器错误 > 时钟 > 磁盘 > 网络设备 >  终端 > 软件中断
```

当发生软件中断时，其他所有的中断都可能发生并被处理；但当发生磁盘中断时，就只有时钟中断和机器错误中断能被处理了。

# 系统调用

先说下进程的执行在系统上的两个级别：用户级和核心级，也称为用户态和系统态。程序的执行一般是在用户态下执行的，但当程序需要使用**操作系统提供的服务**时，比如说打开某一设备、创建文件、读写文件等，就需要向操作系统发出调用服务的请求，这就是系统调用。

Linux系统有专门的函数库来提供这些请求操作系统服务的入口，这个函数库中包含了操作系统所提供的对外服务的接口。当进程发出系统调用之后，它所处的运行状态就会由用户态变成核心态。但这个时候，进程本身其实并没有做什么事情，这个时候是由内核在做相应的操作，去完成进程所提出的这些请求。

## 系统调用和中断关系

系统调用和中断的关系就在于，当进程发出系统调用申请的时候，会产生一个**软件中断**。产生这个软件中断以后，系统会去对这个软中断进行处理，这个时候进程就处于核心态了。

## 用户态和系统态区别

1. 用户态的进程能存取它们自己的指令和数据，但不能存取内核指令和数据（或其他进程的指令和数据）。然而，**核心态下的进程能够存取内核和用户地址**
2. 某些机器指令是特权指令，在用户态下执行特权指令会引起错误

# 内核

- 操作系统内核是操作系统的核心，负责系统的**内存管理，硬件设备的管理，文件系统的管理以及应用程序的管理**
- 同时是连接应用程序和硬件的桥梁，**决定着操作系统的性能和稳定性**。

# CPU

- CPU 是一台计算机的运算核心+控制核心
- 主要包括控制器和运算器
- 根本任务是执行指令

# CPU 与 内核

- 操作系统的内核属于操作系统层面的，而 CPU 属于硬件层面的
- CPU 主要提供运算，处理各种指令；内核主要负责系统管理，同时为应用屏蔽对硬件的操作。

![Kernel_Layout](..\img\Kernel_Layout.png)

