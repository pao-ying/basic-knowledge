# 解决表单重复提交问题

- 确保按钮只能提交一次

  如点击后按钮变灰或者页面显示 loading，或者遮罩层，专门防止重复点击

- 在 session 存放唯一标识

  用户进入页面时，服务端生成一个唯一的标识值，存到session中，同时将它写入表单的隐藏域中，用户在输入信息后点击提交，在服务端获取表单的隐藏域字段的值来与session中的唯一标识值进行比较，相等则说明是首次提交，就处理本次请求，然后删除session唯一标识，不相等则标识重复提交，忽略本次处理。

- 缓存队列

  将请求快速的接收下来，放入缓冲队列中，后续**使用异步任务处理队列的数据，过滤掉重复请求**，我们可以用LinkedList来实现队列，一个HashSet来实现去重。此方法优点是异步处理、高吞吐，但是不能及时返回请求结果，需要后续轮询处理结果。

- token + redis

  这种方式分成两个阶段：获取token和业务操作阶段。

  以支付为例:
   第一阶段，在进入到提交订单页面之前，需要在订单系统根据当前用户信息向支付系统发起一次申请token请求，支付系统将token保存到redis中，作为第二阶段支付使用 第二阶段，前端订单系统拿着申请到的token发起支付请求，支付系统会检查redis中是否存在该token，如果有，表示第一次请求支付，开始处理支付逻辑，处理完成后删除redis中的token 当重复请求时候，检查redis中token是否存在，若不存在,则为重复请求

- 基于乐观锁

  如果更新已有数据，可以进行加锁更新，也可以设计表结构时使用version来做乐观锁，这样既能保证执行效率，又能保证幂等。乐观锁version字段在更新业务数据时值要自增。

  sql为：update table set version = version + 1 where id =1 and version =#{version }

- 